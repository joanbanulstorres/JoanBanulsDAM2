<?php
    session_start();

    include "config.php";

    $mysqli = new  mysqli($mydbserver, $mydbuser, $mydbpassword, $mydb);

    $consulta = "SELECT * FROM usuarios WHERE usuario = '".$_POST['usuario']."' AND contrasena = '".$_POST['contrasena']."'";
    
    $resultado = $mysqli -> query($consulta);

    if(preg_match('~\b(delete|drop|truncate)\b~i', $_POST['usuario']) || preg_match('~\b(delete|drop|truncate)\b~i', $_POST['contrasena'])){
        echo '<p style="font-family:sans-serif; color:red">Se ha intentado modificar el contenido de la base de datos</p>';
    }
    
    $pasas = false;
    while($fila = $resultado -> fetch_assoc()){     // Si la consulta devuelve un resultado, significa que existe un registro con el usuario y la contrase√±a introducidos
        $pasas = true;
    }

    if($pasas == true){
        echo '<p style="font-family:sans-serif">Datos de acceso correctos</p>';
    }else{
        echo '<p style="font-family:sans-serif">Datos de acceso incorrectos. Redirigiendo...</p>';
        header("refresh:5; url=formulario.php");
    }

?>
